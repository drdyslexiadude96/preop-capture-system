<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Dental & Airway Capture System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; padding:20px; }
.container { max-width:900px; margin:auto; background:#fff; padding:25px; border-radius:10px; }
.section { border-top:1px solid #ddd; margin-top:25px; padding-top:20px; }
.preview { max-width:220px; margin-top:10px; border:1px solid #ccc; display:block; }
.findings { background:#f9f9f9; padding:10px; margin-top:10px; border-radius:6px; }
label { display:block; margin:4px 0; }
button { margin-top:30px; padding:14px 20px; font-size:16px; cursor:pointer; }
</style>
</head>

<body>
<div class="container">

<h1>Pre-Operative Dental & Airway Capture System</h1>

<!-- I1 -->
<div class="section">
<h2>I1 – Airway View</h2>
<input type="file" id="I1" accept="image/*" onchange="preview(this,'p1')">
<img id="p1" class="preview">

<label><input type="checkbox" id="tongue"> Tongue obstruction noted</label>

<label>Mallampati Class
<select id="mallampati">
<option value="">Select</option>
<option value="I">I</option>
<option value="II">II</option>
<option value="III">III</option>
<option value="IV">IV</option>
</select>
</label>

<div class="findings">
<strong>Mallampati Rationale (Observed)</strong>
<label><input type="checkbox" id="soft"> Soft palate visible</label>
<label><input type="checkbox" id="uvula"> Uvula visible</label>
<label><input type="checkbox" id="pillars"> Faucial pillars visible</label>
<label><input type="checkbox" id="hard"> Only hard palate visible</label>
</div>
</div>

<!-- Dentition -->
<script>
const dentitions = ["I2","I3","I4","I5"];
</script>

<div class="section">
<h2>I2 – Upper Dentition</h2>
<input type="file" id="I2" accept="image/*" onchange="preview(this,'p2')">
<img id="p2" class="preview">
<div class="findings">
<label><input type="checkbox" id="I2_missing"> Missing teeth</label>
<label><input type="checkbox" id="I2_crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="I2_chips"> Chips / fractures</label>
</div>
</div>

<div class="section">
<h2>I3 – Lower Dentition</h2>
<input type="file" id="I3" accept="image/*" onchange="preview(this,'p3')">
<img id="p3" class="preview">
<div class="findings">
<label><input type="checkbox" id="I3_missing"> Missing teeth</label>
<label><input type="checkbox" id="I3_crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="I3_chips"> Chips / fractures</label>
</div>
</div>

<div class="section">
<h2>I4 – Right Molars</h2>
<input type="file" id="I4" accept="image/*" onchange="preview(this,'p4')">
<img id="p4" class="preview">
<div class="findings">
<label><input type="checkbox" id="I4_missing"> Missing teeth</label>
<label><input type="checkbox" id="I4_crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="I4_chips"> Chips / fractures</label>
</div>
</div>

<div class="section">
<h2>I5 – Left Molars</h2>
<input type="file" id="I5" accept="image/*" onchange="preview(this,'p5')">
<img id="p5" class="preview">
<div class="findings">
<label><input type="checkbox" id="I5_missing"> Missing teeth</label>
<label><input type="checkbox" id="I5_crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="I5_chips"> Chips / fractures</label>
</div>
</div>

<div class="section">
<h2>I6 – Natural Occlusion</h2>
<input type="file" id="I6" accept="image/*" onchange="preview(this,'p6')">
<img id="p6" class="preview">
<label><input type="checkbox" id="occlusion"> Occlusal instability</label>
</div>

<button onclick="generatePDF()">Generate PDF Report</button>

</div>

<script>
function preview(input,id){
  if(input.files[0]){
    document.getElementById(id).src = URL.createObjectURL(input.files[0]);
  }
}
function yn(id){ return document.getElementById(id).checked ? "Yes" : "No"; }

function addImage(pdf,id,y){
  const img=document.getElementById(id);
  if(img && img.src){
    pdf.addImage(img,'JPEG',20,y,170,120);
    return y+130;
  }
  return y;
}

function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y=20;

  pdf.setFontSize(16);
  pdf.text("Pre-Operative Dental & Airway Report (Interpreted)",20,y); y+=15;

  pdf.setFontSize(13);
  pdf.text("Airway Assessment",20,y); y+=10;
  pdf.setFontSize(12);
  pdf.text(`Mallampati Class: ${mallampati.value}`,20,y); y+=6;
  pdf.text(`Tongue Obstruction: ${yn("tongue")}`,20,y); y+=8;

  y=addImage(pdf,"p1",y);

  pdf.text("Mallampati Rationale (Observed):",20,y); y+=6;
  pdf.text(`• Soft palate visible: ${yn("soft")}`,25,y); y+=6;
  pdf.text(`• Uvula visible: ${yn("uvula")}`,25,y); y+=6;
  pdf.text(`• Faucial pillars visible: ${yn("pillars")}`,25,y); y+=6;
  pdf.text(`• Only hard palate visible: ${yn("hard")}`,25,y); y+=10;

  let airwayRisk="LOW";
  if(mallampati.value==="III"||mallampati.value==="IV"||document.getElementById("tongue").checked){
    airwayRisk="MODERATE";
  }
  if(mallampati.value==="IV"&&document.getElementById("tongue").checked){
    airwayRisk="HIGH";
  }
  pdf.text(`Airway Risk (Rules-based): ${airwayRisk}`,20,y); y+=12;

  pdf.setFontSize(13);
  pdf.text("Dentition Findings by Image",20,y); y+=10;
  pdf.setFontSize(12);

  let dentalScore=0;
  ["I2","I3","I4","I5"].forEach((i,idx)=>{
    pdf.text(`${i}:`,20,y); y+=6;
    y=addImage(pdf,"p"+(idx+2),y);
    pdf.text(`• Missing teeth: ${yn(i+"_missing")}`,25,y); if(document.getElementById(i+"_missing").checked)dentalScore++; y+=6;
    pdf.text(`• Crowns/restorations: ${yn(i+"_crowns")}`,25,y); if(document.getElementById(i+"_crowns").checked)dentalScore++; y+=6;
    pdf.text(`• Chips/fractures: ${yn(i+"_chips")}`,25,y); if(document.getElementById(i+"_chips").checked)dentalScore++; y+=10;
  });

  if(document.getElementById("occlusion").checked)dentalScore++;

  let dentalRisk="LOW";
  if(dentalScore>=2)dentalRisk="MODERATE";
  if(dentalScore>=4)dentalRisk="HIGH";

  pdf.text(`Occlusal Instability: ${yn("occlusion")}`,20,y); y+=8;
  pdf.text(`Dental Risk (Rules-based): ${dentalRisk}`,20,y); y+=12;

  pdf.text("Disclaimer: AI-assisted screening support tool. Clinical judgment required.",20,y);

  pdf.save("PreOp_Dental_Airway_Report.pdf");
}
</script>

</body>
</html>
