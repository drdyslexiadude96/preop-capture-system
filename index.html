<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Dental & Airway Capture System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; padding:20px; }
.container { max-width:950px; margin:auto; background:#fff; padding:25px; border-radius:10px; }
h1,h2,h3 { margin-top:25px; }
.section { border-top:1px solid #ddd; padding-top:20px; margin-top:20px; }
.preview { max-width:240px; margin-top:10px; display:block; border:1px solid #ccc; }
.findings { margin-top:10px; padding:10px; background:#f9f9f9; border-radius:6px; }
label { display:block; margin:4px 0; }
button { padding:12px 18px; font-size:16px; margin-top:30px; cursor:pointer; }
small { color:#666; }
</style>
</head>

<body>
<div class="container">

<h1>Pre-Operative Dental & Airway Capture System</h1>

<!-- I1 AIRWAY -->
<div class="section">
<h2>I1 – Airway View</h2>
<p><b>Capture:</b> Mouth open, tongue protruded, patient upright</p>
<p><b>Clinical Purpose:</b> Mallampati classification, tongue obstruction</p>

<input type="file" id="I1" accept="image/*" onchange="preview(this,'p1')">
<img id="p1" class="preview">

<label><input type="checkbox" id="tongue"> Tongue obstruction noted</label>

<label>Mallampati Class
<select id="mallampati">
<option value="">Select</option>
<option value="I">I</option>
<option value="II">II</option>
<option value="III">III</option>
<option value="IV">IV</option>
</select>
</label>

<div class="findings">
<strong>Mallampati Rationale (select all observed)</strong>
<label><input type="checkbox" id="mp_soft"> Soft palate visible</label>
<label><input type="checkbox" id="mp_uvula"> Uvula partially/fully visible</label>
<label><input type="checkbox" id="mp_tonsils"> Tonsillar pillars visible</label>
<label><input type="checkbox" id="mp_hard"> Only hard palate visible</label>
</div>
</div>

<!-- DENTITION TEMPLATE -->
<script>
function dentitionBlock(id,title,capture,purpose){
document.write(`
<div class="section">
<h2>${id} – ${title}</h2>
<p><b>Capture:</b> ${capture}</p>
<p><b>Clinical Purpose:</b> ${purpose}</p>

<input type="file" id="${id}" accept="image/*" onchange="preview(this,'p${id}')">
<img id="p${id}" class="preview">

<div class="findings">
<strong>Dentition Findings</strong>
<label><input type="checkbox" id="${id}_missing"> Missing teeth</label>
<label><input type="checkbox" id="${id}_crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="${id}_chips"> Chips / fractures</label>
</div>
</div>
`);
}
dentitionBlock("I2","Upper Dentition","Frontal maxillary view with cheek retraction","Missing teeth, crowns, chips");
dentitionBlock("I3","Lower Dentition","Frontal mandibular view with cheek retraction","Missing teeth, crowns, chips");
dentitionBlock("I4","Right Molars","Right posterior dentition with cheek displacement","Posterior dental injury risk");
dentitionBlock("I5","Left Molars","Left posterior dentition with cheek displacement","Posterior dental injury risk");
</script>

<!-- I6 -->
<div class="section">
<h2>I6 – Natural Occlusion</h2>
<p><b>Capture:</b> Frontal bite view with teeth in contact</p>
<p><b>Clinical Purpose:</b> Occlusal alignment, instability</p>

<input type="file" id="I6" accept="image/*" onchange="preview(this,'p6')">
<img id="p6" class="preview">

<label><input type="checkbox" id="occlusion"> Occlusal instability</label>
</div>

<button onclick="generatePDF()">Generate PDF Report</button>

<p><small>AI-assisted screening support tool. Clinical judgment required.</small></p>

</div>

<script>
function preview(input,id){
 if(input.files[0]){
  document.getElementById(id).src = URL.createObjectURL(input.files[0]);
 }
}
function yn(id){ return document.getElementById(id)?.checked ? "Yes" : "No"; }

async function addImage(pdf,input,y){
 if(!input.files[0]) return y;
 const img = await new Promise(r=>{
  const reader=new FileReader();
  reader.onload=()=>r(reader.result);
  reader.readAsDataURL(input.files[0]);
 });
 pdf.addImage(img,"JPEG",20,y,80,100);
 return y+110;
}

async function generatePDF(){
 const { jsPDF } = window.jspdf;
 const pdf = new jsPDF();
 let y=20;

 pdf.setFontSize(16);
 pdf.text("Pre-Operative Dental & Airway Report",20,y); y+=12;

 pdf.setFontSize(12);
 pdf.text("Airway Assessment",20,y); y+=8;
 pdf.text("Capture: Mouth open, tongue protruded, patient upright",20,y); y+=6;
 pdf.text("Clinical Purpose: Mallampati classification, tongue obstruction",20,y); y+=8;

 y = await addImage(pdf,document.getElementById("I1"),y);

 pdf.text(`Mallampati Class: ${document.getElementById("mallampati").value}`,20,y); y+=6;
 pdf.text(`Tongue Obstruction: ${yn("tongue")}`,20,y); y+=10;

 pdf.text("Dentition Findings by Image",20,y); y+=8;

 for(const i of ["I2","I3","I4","I5"]){
  pdf.text(`${i}:`,20,y); y+=6;
  y = await addImage(pdf,document.getElementById(i),y);
  pdf.text(`• Missing teeth: ${yn(i+"_missing")}`,25,y); y+=5;
  pdf.text(`• Crowns/restorations: ${yn(i+"_crowns")}`,25,y); y+=5;
  pdf.text(`• Chips/fractures: ${yn(i+"_chips")}`,25,y); y+=8;
 }

 pdf.text(`Occlusal Instability: ${yn("occlusion")}`,20,y); y+=8;

 pdf.setFontSize(10);
 pdf.text("Disclaimer: AI-assisted screening; clinical judgment required.",20,y);

 pdf.save("PreOp_Dental_Airway_Report.pdf");
}
</script>

</body>
</html>
