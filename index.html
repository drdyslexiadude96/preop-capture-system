<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Dental & Airway Capture System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body { font-family: Arial, Helvetica, sans-serif; margin:30px; }
h1 { font-size:34px; }
h2 { margin-top:30px; }
.section { margin-bottom:25px; }
label { display:block; margin:6px 0; }
.complete { color:green; font-weight:bold; }
.incomplete { color:red; font-weight:bold; }
button { padding:10px 18px; font-size:16px; }
img.preview { max-width:250px; margin-top:6px; border:1px solid #ccc; display:none; }
hr { margin:25px 0; }
</style>
</head>

<body>

<h1>Pre-Operative Dental & Airway Capture System</h1>
<strong>Patent Pending</strong><br><br>

<label>
Patient / Session ID:
<input type="text" id="sessionId" placeholder="Auto-generated if left blank">
</label>

<hr>

<!-- I1 -->
<div class="section">
<h2>I1 — Airway View <span id="s1" class="incomplete">Incomplete</span></h2>

<input type="file" id="i1"><br>
<label><input type="checkbox" id="tongueObs"> Tongue obstruction noted</label>

<label>
Mallampati Class:
<select id="mallampati">
<option value="">Select</option>
<option>I</option>
<option>II</option>
<option>III</option>
<option>IV</option>
</select>
</label>

<h3>Mallampati Rationale (Observed)</h3>
<label><input type="checkbox" id="soft"> Soft palate visible</label>
<label><input type="checkbox" id="uvula"> Uvula visible</label>
<label><input type="checkbox" id="pillars"> Faucial pillars visible</label>
<label><input type="checkbox" id="hard"> Only hard palate visible</label>
</div>

<hr>

<!-- I2–I6 -->
<div class="section">
<h2>Dentition Images</h2>

<div>
I2 — Upper Dentition <span id="s2" class="incomplete">Incomplete</span><br>
<input type="file" id="i2"><br>
<label><input type="checkbox"> Missing teeth</label>
<label><input type="checkbox"> Crowns / restorations</label>
<label><input type="checkbox"> Chips / fractures</label>
</div><hr>

<div>
I3 — Lower Dentition <span id="s3" class="incomplete">Incomplete</span><br>
<input type="file" id="i3"><br>
<label><input type="checkbox"> Missing teeth</label>
<label><input type="checkbox"> Crowns / restorations</label>
<label><input type="checkbox"> Chips / fractures</label>
</div><hr>

<div>
I4 — Right Molars <span id="s4" class="incomplete">Incomplete</span><br>
<input type="file" id="i4"><br>
<label><input type="checkbox"> Missing teeth</label>
<label><input type="checkbox"> Crowns / restorations</label>
<label><input type="checkbox"> Chips / fractures</label>
</div><hr>

<div>
I5 — Left Molars <span id="s5" class="incomplete">Incomplete</span><br>
<input type="file" id="i5"><br>
<label><input type="checkbox"> Missing teeth</label>
<label><input type="checkbox"> Crowns / restorations</label>
<label><input type="checkbox"> Chips / fractures</label>
</div><hr>

<div>
I6 — Natural Occlusion <span id="s6" class="incomplete">Incomplete</span><br>
<input type="file" id="i6"><br>
<label><input type="checkbox"> Missing teeth</label>
<label><input type="checkbox"> Crowns / restorations</label>
<label><input type="checkbox"> Chips / fractures</label>
</div>
</div>

<hr>

<!-- LAYER 2 -->
<div class="section">
<h2>Clinical Interpretation</h2>
<div id="interpretation"><em>Complete airway inputs to generate interpretation.</em></div>

<h3>Reviewer</h3>
<label>Reviewed by: <input type="text" id="reviewer"></label>
<label>
Role:
<select id="role">
<option value="">Select</option>
<option>Anesthesiologist</option>
<option>CRNA</option>
<option>Other</option>
</select>
</label>
<label><input type="checkbox" id="reviewed"> Reviewed prior to induction</label>
</div>

<hr>

<button id="pdfBtn" disabled>Generate PDF Report</button>

<script>
const dentition = ["i2","i3","i4","i5","i6"];

dentition.forEach((id,i)=>{
document.getElementById(id).addEventListener("change",()=>{
document.getElementById("s"+(i+2)).textContent="Complete";
document.getElementById("s"+(i+2)).className="complete";
checkReady();
});
});

function checkReady(){
const allDentition = dentition.every(id=>document.getElementById(id).files.length>0);
const airwayComplete = mallampati.value !== "";
document.getElementById("s1").textContent = airwayComplete ? "Complete" : "Incomplete";
document.getElementById("s1").className = airwayComplete ? "complete" : "incomplete";
document.getElementById("pdfBtn").disabled = !(allDentition && airwayComplete);
updateInterpretation();
}

function cst(){
return new Date().toLocaleString("en-US",{timeZone:"America/Chicago"});
}

function updateInterpretation(){
if(!mallampati.value){
interpretation.innerHTML="<em>Complete airway inputs to generate interpretation.</em>";
return;
}
let risk="LOW";
if(mallampati.value==="II") risk="MODERATE";
if(mallampati.value==="III"||mallampati.value==="IV"||tongueObs.checked) risk="HIGH";

let findings=[];
if(soft.checked) findings.push("Soft palate visible");
if(uvula.checked) findings.push("Uvula visible");
if(pillars.checked) findings.push("Faucial pillars visible");
if(hard.checked) findings.push("Only hard palate visible");

interpretation.innerHTML=
"<strong>Airway Risk:</strong> "+risk+"<br>"+
"<strong>Interpretation:</strong> Mallampati "+mallampati.value+
(tongueObs.checked?" with tongue obstruction noted.":".")+
"<br><strong>Observed Findings:</strong><br>"+
(findings.length?findings.join("<br>"):"—");
}

["mallampati","tongueObs","soft","uvula","pillars","hard"].forEach(id=>{
document.getElementById(id).addEventListener("change",checkReady);
});

pdfBtn.onclick=()=>{
const sid=sessionId.value||"SESSION-"+Date.now();
const pdf=document.createElement("div");
pdf.innerHTML=`
<h1>Pre-Operative Dental & Airway Report</h1>
<p><strong>Session ID:</strong> ${sid}</p>
<p><strong>Capture Timestamp (CST):</strong> ${cst()}</p>
<p><strong>Mallampati Class:</strong> ${mallampati.value}</p>
<p><strong>Tongue Obstruction:</strong> ${tongueObs.checked?"Yes":"No"}</p>
${interpretation.innerHTML}
<p><strong>Reviewed by:</strong> ${reviewer.value||"—"}</p>
<p><strong>Role:</strong> ${role.value||"—"}</p>
<p><strong>Reviewed prior to induction:</strong> ${reviewed.checked?"Yes":"No"}</p>
<p><strong>Review Timestamp (CST):</strong> ${cst()}</p>
`;
html2pdf().from(pdf).save(`PreOp_${sid}.pdf`);
};
</script>

</body>
</html>
