<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pre-Operative Capture System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- PDF library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#eef2f7;
  padding:2rem;
}
.card {
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:2.5rem;
  border-radius:14px;
  box-shadow:0 12px 40px rgba(0,0,0,.12);
}
h1,h2 { margin-top:0; }
.progress-text { color:#555; font-size:.95rem; }
.progress {
  height:14px;
  background:#ddd;
  border-radius:7px;
  margin:1rem 0 2rem;
}
.progress > div {
  height:100%;
  width:0%;
  background:#22c55e;
  border-radius:7px;
}
input { margin-top:1rem; }
img {
  display:none;
  margin-top:1rem;
  max-width:100%;
  border-radius:10px;
  border:1px solid #ccc;
}
button {
  margin-top:1.5rem;
  padding:.85rem 1.6rem;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:#fff;
  font-size:1rem;
  cursor:pointer;
}
button:disabled { background:#9ca3af; }
.actions button {
  width:100%;
  margin:1rem 0;
  text-align:left;
}
.secondary { background:#334155; }
.export { background:#0f766e; }
</style>
</head>

<body>

<div class="card" id="card">
  <h1>Pre-Operative Capture System</h1>

  <p class="progress-text" id="status"></p>
  <div class="progress"><div id="bar"></div></div>

  <h2 id="title"></h2>
  <p id="desc"></p>

  <input type="file" id="file" accept="image/*" />
  <img id="img" />

  <button id="next" disabled>Next Required Capture</button>
</div>

<script>
const { jsPDF } = window.jspdf;

const steps = [
  "I1 ‚Äì Airway View",
  "I2 ‚Äì Upper Dentition",
  "I3 ‚Äì Lower Dentition",
  "I4 ‚Äì Right Molars",
  "I5 ‚Äì Left Molars",
  "I6 ‚Äì Natural Occlusion"
];

const instructions = [
  "Mouth open, tongue protruded, upright.",
  "Frontal maxillary view.",
  "Frontal mandibular view.",
  "Right posterior teeth.",
  "Left posterior teeth.",
  "Teeth in contact."
];

let i = 0;
const images = [];

const status = document.getElementById("status");
const bar = document.getElementById("bar");
const title = document.getElementById("title");
const desc = document.getElementById("desc");
const file = document.getElementById("file");
const img = document.getElementById("img");
const next = document.getElementById("next");
const card = document.getElementById("card");

function loadStep() {
  status.textContent = `Required Capture ${i+1} of 6`;
  bar.style.width = `${(i/6)*100}%`;
  title.textContent = steps[i];
  desc.textContent = instructions[i];
  img.style.display = "none";
  next.disabled = true;
}

file.onchange = () => {
  const f = file.files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = e => {
    images.push(e.target.result);
    img.src = e.target.result;
    img.style.display = "block";
    next.disabled = false;
  };
  r.readAsDataURL(f);
};

next.onclick = () => {
  i++;
  if (i < 6) {
    file.value = "";
    loadStep();
  } else {
    showCompletion();
  }
};

function showCompletion() {
  card.innerHTML = `
    <h1>Pre-Operative Capture System</h1>

    <p class="progress-text">Required Capture 6 of 6</p>
    <div class="progress"><div style="width:100%"></div></div>

    <h2>Capture Complete</h2>

    <p>
      <strong>All required images captured.</strong><br><br>
      <em>System is ready for analysis, report generation, or secure export.</em>
    </p>

    <div class="actions">
      <button onclick="alert('Analysis module coming next')">
        üß† Proceed to Automated Analysis
      </button>

      <button class="secondary" onclick="generatePDF()">
        üìÑ Generate Capture Report (PDF)
      </button>

      <button class="export" onclick="alert('Secure export coming next')">
        üîÅ Export / Secure Handoff
      </button>
    </div>
  `;
}

function generatePDF() {
  const pdf = new jsPDF();
  let y = 15;

  pdf.setFontSize(16);
  pdf.text("Pre-Operative Capture Report", 10, y);
  y += 10;

  pdf.setFontSize(10);
  pdf.text(`Generated: ${new Date().toLocaleString()}`, 10, y);
  y += 10;

  steps.forEach((step, idx) => {
    pdf.text(`${step} ‚úî`, 10, y);
    y += 6;

    if (images[idx]) {
      pdf.addImage(images[idx], "JPEG", 10, y, 60, 45);
      y += 50;
      if (y > 250) {
        pdf.addPage();
        y = 15;
      }
    }
  });

  pdf.save("PreOp_Capture_Report.pdf");
}

loadStep();
</script>

</body>
</html>
