<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Dental & Airway Capture System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:30px}
h1{font-size:34px}
h2{margin-top:30px}
.section{margin-bottom:25px}
label{display:block;margin:6px 0}
.complete{color:green;font-weight:bold}
.incomplete{color:red;font-weight:bold}
button{padding:10px 18px;font-size:16px}
img.preview{max-width:250px;margin-top:6px;border:1px solid #ccc}
.pdf-section img{max-width:300px;margin-bottom:10px}
</style>
</head>

<body>

<h1>Pre-Operative Dental & Airway Capture System</h1>
<strong>Patent Pending</strong><br><br>

<div id="capture">

<!-- I1 -->
<div class="section">
<h2>I1 — Airway View <span id="i1status" class="incomplete">Incomplete</span></h2>
<input type="file" id="airwayImg" accept="image/*"><br>
<label><input type="checkbox" id="tongueObs"> Tongue obstruction noted</label>
<label>Mallampati Class:
<select id="mallampati">
<option value="">Select</option>
<option>I</option>
<option>II</option>
<option>III</option>
<option>IV</option>
</select>
</label>

<strong>Mallampati Rationale (Observed)</strong>
<label><input type="checkbox" id="soft"> Soft palate visible</label>
<label><input type="checkbox" id="uvula"> Uvula visible</label>
<label><input type="checkbox" id="pillars"> Faucial pillars visible</label>
<label><input type="checkbox" id="hard"> Only hard palate visible</label>

<img id="airwayPreview" class="preview">
</div>

<!-- Dentition -->
<h2>Dentition Images</h2>

<div class="section">
<h3>I2 — Upper Dentition <span id="i2status" class="incomplete">Incomplete</span></h3>
<input type="file" id="i2img" accept="image/*">
<img id="i2prev" class="preview">
</div>

<div class="section">
<h3>I3 — Lower Dentition <span id="i3status" class="incomplete">Incomplete</span></h3>
<input type="file" id="i3img" accept="image/*">
<img id="i3prev" class="preview">
</div>

<div class="section">
<h3>I4 — Right Molars <span id="i4status" class="incomplete">Incomplete</span></h3>
<input type="file" id="i4img" accept="image/*">
<img id="i4prev" class="preview">
</div>

<div class="section">
<h3>I5 — Left Molars <span id="i5status" class="incomplete">Incomplete</span></h3>
<input type="file" id="i5img" accept="image/*">
<img id="i5prev" class="preview">
</div>

<div class="section">
<h3>I6 — Natural Occlusion <span id="i6status" class="incomplete">Incomplete</span></h3>
<input type="file" id="i6img" accept="image/*">
<img id="i6prev" class="preview">
</div>

<!-- Clinical Interpretation -->
<div class="section">
<h2>Clinical Interpretation</h2>
<div id="interpretationBox">Complete airway inputs to generate interpretation.</div>
</div>

</div>

<button onclick="generatePDF()">Generate PDF Report</button>

<script>
function preview(fileInput, imgEl, statusEl){
 if(!fileInput.files[0]) return;
 const reader=new FileReader();
 reader.onload=e=>{
   imgEl.src=e.target.result;
   statusEl.textContent="Complete";
   statusEl.className="complete";
 };
 reader.readAsDataURL(fileInput.files[0]);
}

["airway","i2","i3","i4","i5","i6"].forEach(id=>{
 document.getElementById(id+"Img")?.addEventListener("change",e=>{
   preview(e.target, document.getElementById(id+"Preview")||document.getElementById(id+"prev"), document.getElementById(id+"status"));
   updateInterpretation();
 });
});

function updateInterpretation(){
 const m=document.getElementById("mallampati").value;
 if(!m) return;
 let risk="LOW";
 if(m==="II") risk="MODERATE";
 if(m==="III"||m==="IV"||document.getElementById("tongueObs").checked) risk="HIGH";

 let findings=[];
 if(soft.checked) findings.push("Soft palate visible");
 if(uvula.checked) findings.push("Uvula visible");
 if(pillars.checked) findings.push("Faucial pillars visible");
 if(hard.checked) findings.push("Only hard palate visible");

 interpretationBox.innerHTML=
 `<strong>Airway Risk:</strong> ${risk}<br>
 <strong>Interpretation:</strong> Mallampati ${m}${tongueObs.checked?" with tongue obstruction noted":""}.<br>
 <strong>Observed Findings:</strong><br>${findings.join("<br>")||"—"}`;
}

document.querySelectorAll("input,select").forEach(el=>el.addEventListener("change",updateInterpretation));

function generatePDF(){
 const clone=document.getElementById("capture").cloneNode(true);
 clone.classList.add("pdf-section");

 const now=new Date().toLocaleString("en-US",{timeZone:"America/Chicago"});
 const stamp=document.createElement("div");
 stamp.innerHTML="<br><strong>Generated:</strong> "+now+" CST<br><br>";
 clone.prepend(stamp);

 html2pdf().set({
   margin:0.5,
   filename:"PreOp_Report.pdf",
   image:{type:"jpeg",quality:0.98},
   html2canvas:{scale:2,useCORS:true},
   jsPDF:{unit:"in",format:"letter",orientation:"portrait"}
 }).from(clone).save();
}
</script>

</body>
</html>
