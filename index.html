<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Capture System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#eef2f7;
  padding:2rem;
}
.container {
  background:white;
  max-width:960px;
  margin:auto;
  padding:2rem;
  border-radius:12px;
}
.section {
  margin-bottom:2rem;
  border-bottom:1px solid #ddd;
  padding-bottom:1.5rem;
}
label { display:block; margin:.4rem 0; }
input[type="file"] { margin:.5rem 0; }
button {
  margin-top:1.5rem;
  padding:1rem;
  font-size:1rem;
  border:none;
  border-radius:8px;
  background:#1f2937;
  color:white;
  cursor:pointer;
}
.note {
  font-size:.85rem;
  color:#555;
  margin-top:1rem;
}
.preview {
  margin-top:.5rem;
  max-width:200px;
  border:1px solid #ccc;
}
</style>
</head>

<body>
<div class="container">

<h1>Pre-Operative Capture System</h1>

<!-- I1 AIRWAY -->
<div class="section">
<h2>I1 – Airway View</h2>
<input type="file" accept="image/*" onchange="preview(this, 'img1')">
<img id="img1" class="preview">

<label><input type="checkbox" id="tongue"> Tongue obstruction noted</label>

<label>Mallampati Class</label>
<select id="mallampati">
  <option value="">Select</option>
  <option value="1">Class I</option>
  <option value="2">Class II</option>
  <option value="3">Class III</option>
  <option value="4">Class IV</option>
</select>
</div>

<!-- I2–I5 DENTITION -->
<div class="section">
<h2>I2–I5 – Dentition Images</h2>

<input type="file" accept="image/*" onchange="preview(this,'img2')">
<img id="img2" class="preview">

<input type="file" accept="image/*" onchange="preview(this,'img3')">
<img id="img3" class="preview">

<input type="file" accept="image/*" onchange="preview(this,'img4')">
<img id="img4" class="preview">

<input type="file" accept="image/*" onchange="preview(this,'img5')">
<img id="img5" class="preview">

<label><input type="checkbox" id="missing"> Missing teeth</label>
<label><input type="checkbox" id="crowns"> Crowns / restorations</label>
<label><input type="checkbox" id="chips"> Chips / fractures</label>
</div>

<!-- I6 OCCLUSION -->
<div class="section">
<h2>I6 – Natural Occlusion</h2>

<input type="file" accept="image/*" onchange="preview(this,'img6')">
<img id="img6" class="preview">

<label><input type="checkbox" id="occlusion"> Occlusal instability</label>
</div>

<button onclick="generatePDF()">Generate PDF Report</button>

<p class="note">
AI-assisted screening support tool. Final clinical judgment required.
</p>

</div>

<script>
function preview(input, imgId) {
  const img = document.getElementById(imgId);
  img.src = URL.createObjectURL(input.files[0]);
}

function generatePDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const mall = document.getElementById("mallampati").value;
  const tongue = document.getElementById("tongue").checked;
  const missing = document.getElementById("missing").checked;
  const crowns = document.getElementById("crowns").checked;
  const chips = document.getElementById("chips").checked;
  const occlusion = document.getElementById("occlusion").checked;

  let airwayRisk = "Low";
  let dentalRisk = "Low";
  let airwayNotes = [];
  let dentalNotes = [];

  if (mall >= 3) {
    airwayRisk = "Elevated";
    airwayNotes.push("Elevated Mallampati class");
  }
  if (tongue) airwayNotes.push("Tongue obstruction observed");

  if (missing || chips || occlusion) dentalRisk = "Elevated";
  if (missing) dentalNotes.push("Missing teeth");
  if (crowns) dentalNotes.push("Crowns/restorations");
  if (chips) dentalNotes.push("Chips/fractures");
  if (occlusion) dentalNotes.push("Occlusal instability");

  pdf.text("Pre-Operative Dental & Airway Assessment",10,15);
  pdf.text(`Mallampati Class: ${mall || "Not selected"}`,10,30);
  pdf.text(`Airway Risk: ${airwayRisk}`,10,38);
  airwayNotes.forEach((n,i)=>pdf.text(`- ${n}`,12,46+i*8));

  let y = 46 + airwayNotes.length*8 + 10;
  pdf.text(`Dental Risk: ${dentalRisk}`,10,y);
  dentalNotes.forEach((n,i)=>pdf.text(`- ${n}`,12,y+8+i*8));

  pdf.text(
    "Disclaimer: AI-assisted screening; clinical judgment required.",
    10,
    280
  );

  pdf.save("PreOp_Clinical_Report.pdf");
}
</script>

</body>
</html>
