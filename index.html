<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Capture System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#eef2f7;
  padding:2rem;
}
.card {
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:2.5rem;
  border-radius:14px;
  box-shadow:0 12px 40px rgba(0,0,0,.12);
}
h1,h2 { margin-top:0; }
.progress-text { font-size:.95rem; color:#555; }

.progress-bar {
  height:14px;
  background:#ddd;
  border-radius:7px;
  margin:1rem 0 2rem;
}
.progress-fill {
  height:100%;
  width:0%;
  background:#22c55e;
  border-radius:7px;
  transition:width .3s ease;
}

input[type=file] {
  margin-top:1rem;
}

img {
  display:none;
  margin-top:1rem;
  max-width:100%;
  border-radius:10px;
  border:1px solid #ccc;
}

button {
  margin-top:1.5rem;
  padding:.85rem 1.6rem;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:white;
  font-size:1rem;
  cursor:pointer;
}
button.secondary {
  background:#334155;
}
button.export {
  background:#0f766e;
}
button:disabled {
  background:#9ca3af;
  cursor:not-allowed;
}

.actions button {
  display:block;
  width:100%;
  margin:1rem 0;
  text-align:left;
}
</style>
</head>

<body>

<div class="card" id="app">
  <h1>Pre-Operative Capture System</h1>

  <p class="progress-text" id="progressText"></p>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <h2 id="stepTitle"></h2>
  <p id="stepDescription"></p>

  <input type="file" accept="image/*" id="fileInput">
  <img id="preview">

  <button id="nextBtn" disabled>Next Required Capture</button>
</div>

<script>
/* ---------------------------
   CAPTURE DEFINITIONS
---------------------------- */
const steps = [
  ["I1 ‚Äì Airway View","Mouth open, tongue protruded, patient upright."],
  ["I2 ‚Äì Upper Dentition","Frontal view of maxillary teeth."],
  ["I3 ‚Äì Lower Dentition","Frontal view of mandibular teeth."],
  ["I4 ‚Äì Right Molars","Right posterior dentition."],
  ["I5 ‚Äì Left Molars","Left posterior dentition."],
  ["I6 ‚Äì Natural Occlusion","Teeth in contact, frontal bite view."]
];

let index = 0;

/* ---------------------------
   ELEMENT REFERENCES
---------------------------- */
const titleEl = document.getElementById("stepTitle");
const descEl  = document.getElementById("stepDescription");
const progTxt = document.getElementById("progressText");
const progFill= document.getElementById("progressFill");
const fileInp = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const nextBtn = document.getElementById("nextBtn");
const app     = document.getElementById("app");

/* ---------------------------
   LOAD STEP
---------------------------- */
function loadStep() {
  titleEl.textContent = steps[index][0];
  descEl.textContent  = steps[index][1];
  progTxt.textContent = `Required Capture ${index + 1} of ${steps.length}`;
  progFill.style.width = `${(index / steps.length) * 100}%`;

  preview.style.display = "none";
  nextBtn.disabled = true;
}

/* ---------------------------
   FILE HANDLING
---------------------------- */
fileInp.onchange = () => {
  const file = fileInp.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
    preview.style.display = "block";
    nextBtn.disabled = false;
  };
  reader.readAsDataURL(file);
};

/* ---------------------------
   NEXT STEP / COMPLETE
---------------------------- */
nextBtn.onclick = () => {
  index++;

  if (index < steps.length) {
    fileInp.value = "";
    loadStep();
  } else {
    showPostCaptureHub();
  }
};

/* ---------------------------
   POST-CAPTURE HUB (A+B+C)
---------------------------- */
function showPostCaptureHub() {
  progFill.style.width = "100%";
  progTxt.textContent = "Required Capture 6 of 6";

  titleEl.textContent = "Capture Complete";
  descEl.innerHTML = `
    <strong>All required images captured.</strong><br><br>
    Select the next action:
  `;

  fileInp.style.display = "none";
  preview.style.display = "none";
  nextBtn.style.display = "none";

  const actions = document.createElement("div");
  actions.className = "actions";

  actions.innerHTML = `
    <button onclick="runAnalysis()">üß† Proceed to Automated Analysis</button>
    <button class="secondary" onclick="generateReport()">üìÑ Generate Capture Report (PDF)</button>
    <button class="export" onclick="exportData()">üîÅ Export / Secure Handoff</button>
  `;

  app.appendChild(actions);
}

/* ---------------------------
   PLACEHOLDER ACTIONS
---------------------------- */
function runAnalysis() {
  alert(
    "ANALYSIS MODULE\n\n" +
    "This step will evaluate airway risk, dentition anomalies, and clinical flags.\n\n" +
    "Module not yet implemented."
  );
}

function generateReport() {
  alert(
    "REPORT GENERATION\n\n" +
    "This step will compile images, timestamps, and capture checklist into a PDF.\n\n" +
    "Module not yet implemented."
  );
}

function exportData() {
  alert(
    "SECURE EXPORT / HANDOFF\n\n" +
    "This step will package images and metadata for EHR or secure transfer.\n\n" +
    "Module not yet implemented."
  );
}

/* ---------------------------
   INIT
---------------------------- */
loadStep();
</script>

</body>
</html>
