<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pre-Operative Dental & Airway Capture System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body { font-family: Arial, Helvetica, sans-serif; margin: 30px; }
h1 { font-size: 34px; }
h2 { margin-top: 30px; }
.section { border-bottom: 1px solid #ccc; padding: 20px 0; }
.complete { color: green; font-weight: bold; }
.incomplete { color: red; font-weight: bold; }
img.preview { max-width: 260px; margin-top: 10px; border: 1px solid #ccc; }
button { padding: 12px 22px; font-size: 16px; margin-top: 20px; }
.hidden { display:none; }
</style>
</head>

<body>

<div id="app">

<h1>Pre-Operative Dental & Airway Capture System</h1>
<strong>Patent Pending</strong><br><br>

<div class="section">
<b>Patient / Session ID:</b> <span id="sessionId">Patient Pending</span>
</div>

<!-- AIRWAY -->
<div class="section">
<h2>I1 — Airway View <span id="i1Status" class="incomplete">Incomplete</span></h2>

<select id="mallampati">
<option value="">Select Mallampati</option>
<option value="I">I</option>
<option value="II">II</option>
<option value="III">III</option>
<option value="IV">IV</option>
</select>

<label><input type="checkbox" id="tongueObs"> Tongue obstruction noted</label><br><br>

<label><input type="checkbox" class="obs" value="Soft palate visible"> Soft palate visible</label>
<label><input type="checkbox" class="obs" value="Uvula visible"> Uvula visible</label>
<label><input type="checkbox" class="obs" value="Faucial pillars visible"> Faucial pillars visible</label>
<label><input type="checkbox" class="obs" value="Only hard palate visible"> Only hard palate visible</label>
</div>

<!-- DENTITION -->
<h2>Dentition Images</h2>

<div id="dentition"></div>

<!-- CLINICAL -->
<div class="section">
<h2>Clinical Interpretation</h2>
<div id="clinicalText">Complete airway inputs to generate interpretation.</div>
</div>

<button onclick="generatePDF()">Generate PDF Report</button>

</div>

<!-- PDF -->
<div id="pdf" class="hidden"></div>

<script>
const dentitionItems = [
 {id:"I2", label:"Upper Dentition"},
 {id:"I3", label:"Lower Dentition"},
 {id:"I4", label:"Right Molars"},
 {id:"I5", label:"Left Molars"},
 {id:"I6", label:"Natural Occlusion"}
];

const images = {};

function buildDentition() {
 const d = document.getElementById("dentition");
 dentitionItems.forEach(item=>{
  const div=document.createElement("div");
  div.className="section";
  div.innerHTML=`
  <h3>${item.id} — ${item.label} <span id="${item.id}Status" class="incomplete">Incomplete</span></h3>
  <input type="file" accept="image/*" onchange="loadImage(event,'${item.id}')"><br>
  <img id="${item.id}Img" class="preview"><br>
  <label><input type="checkbox"> Missing teeth</label>
  <label><input type="checkbox"> Crowns / restorations</label>
  <label><input type="checkbox"> Chips / fractures</label>
  `;
  d.appendChild(div);
 });
}

function loadImage(e,id){
 const reader=new FileReader();
 reader.onload=()=>{
  images[id]=reader.result;
  document.getElementById(id+"Img").src=reader.result;
  document.getElementById(id+"Status").textContent="Complete";
  document.getElementById(id+"Status").className="complete";
 };
 reader.readAsDataURL(e.target.files[0]);
}

function updateClinical(){
 const m=document.getElementById("mallampati").value;
 const t=document.getElementById("tongueObs").checked;
 if(!m) return;

 let risk=(m==="III"||m==="IV"||t)?"HIGH":"MODERATE";
 let obs=[...document.querySelectorAll(".obs:checked")].map(o=>o.value);

 document.getElementById("i1Status").textContent="Complete";
 document.getElementById("i1Status").className="complete";

 document.getElementById("clinicalText").innerHTML=`
 <b>Airway Risk:</b> ${risk}<br>
 <b>Interpretation:</b> Mallampati ${m}${t?" with tongue obstruction noted.":"."}<br>
 <b>Observed Findings:</b><br>${obs.join("<br>")}
 `;
}

document.getElementById("mallampati").onchange=updateClinical;
document.getElementById("tongueObs").onchange=updateClinical;
document.querySelectorAll(".obs").forEach(o=>o.onchange=updateClinical);

function generatePDF(){
 const pdf=document.getElementById("pdf");
 const now=new Date().toLocaleString("en-US",{timeZone:"America/Chicago"});
 pdf.innerHTML=`
 <h1>Pre-Operative Dental & Airway Report</h1>
 <b>Patient:</b> Patient Pending<br>
 <b>Capture Timestamp (CST):</b> ${now}<br><hr>
 <h2>Clinical Interpretation</h2>${document.getElementById("clinicalText").innerHTML}
 <h2>Dentition Images</h2>
 `;

 dentitionItems.forEach(i=>{
  if(images[i.id]){
   pdf.innerHTML+=`<h3>${i.label}</h3><img src="${images[i.id]}" style="max-width:300px;">`;
  }
 });

 html2pdf().set({margin:10,filename:"PreOp_Report.pdf"}).from(pdf).save();
}

buildDentition();
</script>

</body>
</html>
