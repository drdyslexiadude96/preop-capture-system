<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pre-Operative Dental & Airway Capture System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:30px}
h1{font-size:34px}
h2{margin-top:30px}
.section{margin-bottom:25px}
label{display:block;margin:6px 0}
.complete{color:green;font-weight:bold}
.incomplete{color:red;font-weight:bold}
button{padding:10px 18px;font-size:16px}
img.preview{max-width:250px;margin-top:6px;border:1px solid #ccc}
.pdf img{max-width:300px;margin-bottom:10px}
</style>
</head>

<body>

<h1>Pre-Operative Dental & Airway Capture System</h1>
<strong>Patent Pending</strong><br><br>

<div id="capture">

<!-- AIRWAY -->
<div class="section">
<h2>I1 — Airway View <span id="status_airway" class="incomplete">Incomplete</span></h2>
<input type="file" id="airway_file" accept="image/*">
<label><input type="checkbox" id="tongue"> Tongue obstruction noted</label>

<label>Mallampati Class:
<select id="mallampati">
<option value="">Select</option>
<option>I</option>
<option>II</option>
<option>III</option>
<option>IV</option>
</select>
</label>

<strong>Mallampati Rationale (Observed)</strong>
<label><input type="checkbox" id="soft"> Soft palate visible</label>
<label><input type="checkbox" id="uvula"> Uvula visible</label>
<label><input type="checkbox" id="pillars"> Faucial pillars visible</label>
<label><input type="checkbox" id="hard"> Only hard palate visible</label>

<img id="airway_preview" class="preview">
</div>

<h2>Dentition Images</h2>

<div class="section">
<h3>I2 — Upper Dentition <span id="status_i2" class="incomplete">Incomplete</span></h3>
<input type="file" id="i2_file" accept="image/*">
<img id="i2_preview" class="preview">
</div>

<div class="section">
<h3>I3 — Lower Dentition <span id="status_i3" class="incomplete">Incomplete</span></h3>
<input type="file" id="i3_file" accept="image/*">
<img id="i3_preview" class="preview">
</div>

<div class="section">
<h3>I4 — Right Molars <span id="status_i4" class="incomplete">Incomplete</span></h3>
<input type="file" id="i4_file" accept="image/*">
<img id="i4_preview" class="preview">
</div>

<div class="section">
<h3>I5 — Left Molars <span id="status_i5" class="incomplete">Incomplete</span></h3>
<input type="file" id="i5_file" accept="image/*">
<img id="i5_preview" class="preview">
</div>

<div class="section">
<h3>I6 — Natural Occlusion <span id="status_i6" class="incomplete">Incomplete</span></h3>
<input type="file" id="i6_file" accept="image/*">
<img id="i6_preview" class="preview">
</div>

<div class="section">
<h2>Clinical Interpretation</h2>
<div id="interpretation">Complete airway inputs to generate interpretation.</div>
</div>

</div>

<button onclick="generatePDF()">Generate PDF Report</button>

<script>
function bind(fileId, imgId, statusId){
 document.getElementById(fileId).addEventListener("change",e=>{
  const file=e.target.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=ev=>{
    document.getElementById(imgId).src=ev.target.result;
    const s=document.getElementById(statusId);
    s.textContent="Complete";
    s.className="complete";
  };
  r.readAsDataURL(file);
 });
}

bind("airway_file","airway_preview","status_airway");
bind("i2_file","i2_preview","status_i2");
bind("i3_file","i3_preview","status_i3");
bind("i4_file","i4_preview","status_i4");
bind("i5_file","i5_preview","status_i5");
bind("i6_file","i6_preview","status_i6");

function updateInterpretation(){
 const m=mallampati.value;
 if(!m) return;
 let risk="LOW";
 if(m==="II") risk="MODERATE";
 if(m==="III"||m==="IV"||tongue.checked) risk="HIGH";

 let f=[];
 if(soft.checked) f.push("Soft palate visible");
 if(uvula.checked) f.push("Uvula visible");
 if(pillars.checked) f.push("Faucial pillars visible");
 if(hard.checked) f.push("Only hard palate visible");

 interpretation.innerHTML=
 `<strong>Airway Risk:</strong> ${risk}<br>
 <strong>Interpretation:</strong> Mallampati ${m}${tongue.checked?" with tongue obstruction noted":""}.<br>
 <strong>Observed Findings:</strong><br>${f.join("<br>")||"—"}`;
}

document.querySelectorAll("input,select").forEach(e=>e.addEventListener("change",updateInterpretation));

function generatePDF(){
 const node=document.getElementById("capture").cloneNode(true);
 node.classList.add("pdf");
 const t=new Date().toLocaleString("en-US",{timeZone:"America/Chicago"});
 node.prepend(Object.assign(document.createElement("div"),{innerHTML:`<strong>Generated:</strong> ${t} CST<br><br>`}));

 html2pdf().from(node).set({
  filename:"PreOp_Report.pdf",
  html2canvas:{scale:2},
  jsPDF:{unit:"in",format:"letter",orientation:"portrait"}
 }).save();
}
</script>

</body>
</html>
